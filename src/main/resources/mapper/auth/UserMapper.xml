<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.arclearn.community.mapper.auth.UserMapper">
    <!-- 自定义查询：根据用户名查询用户及关联的角色和权限 -->
    <select id="findByUsernameWithRolesAndPermissions" resultType="com.arclearn.community.entity.auth.User">
        SELECT u.*, r.id as role_id, r.code as role_code, r.name as role_name,
               p.id as perm_id, p.code as perm_code, p.name as perm_name
        FROM user u
                 LEFT JOIN user_role ur ON u.id = ur.user_id
                 LEFT JOIN role r ON ur.role_id = r.id
                 LEFT JOIN role_permission rp ON r.id = rp.role_id
                 LEFT JOIN permission p ON rp.permission_id = p.id
        WHERE u.username = #{username}
    </select>
    <select id="findByUsername" resultType="com.arclearn.community.entity.auth.User">
        SELECT * FROM user WHERE username = #{username}
    </select>
</mapper>